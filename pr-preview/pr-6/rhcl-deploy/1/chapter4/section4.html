<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Getting Started with Red Hat Connectivity Link</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section1.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Getting Started with Red Hat Connectivity Link</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhcl-deploy/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhcl-deploy" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Getting Started with Red Hat Connectivity Link</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter1/index.html">Lab Scenario</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter2/index.html">Infrastructure Engineer Workflow</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section1.html">Setup Route53 in AWS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section2.html">Install Cert-manager Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section3.html">Install and configure Istio with Sail Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section4.html">Install Kuadrant on Red Hat OpenShift cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter2/section5.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter3/index.html">Platform Engineer Workflow</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section1.html">Setting Up DNS and TLS for Kuadrant API Gateway</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section2.html">Create Auth Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section3.html">Create TLS Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section4.html">Create Rate Limit Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section5.html">Create DNS Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter3/section7.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Developer Workflow</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section4.html">Create HTTP Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Toystore Application Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Deploying the Toystore HTTPRoute</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Securing the Toystore Application with Kuadrant Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section5.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Getting Started with Red Hat Connectivity Link</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Getting Started with Red Hat Connectivity Link</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Getting Started with Red Hat Connectivity Link</a></li>
    <li><a href="index.html">Developer Workflow</a></li>
    <li><a href="section4.html">Create HTTP Route</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_create_http_route"><a class="anchor" href="#_create_http_route"></a>Create HTTP Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This lab guides you through the process of setting up and verifying an HTTPRoute for your Gateway, enforcing DNSPolicy and other policies, creating AWS credentials, and configuring the Gateway for use by multiple namespaces while ensuring that the connection is secure and functioning as expected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an <strong>HTTPRoute</strong> for your Gateway by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ <strong>curl -s <a href="https://raw.githubusercontent.com/RedHatQuickCourses/rhcl-qc-apps/refs/heads/main/kuadrant-httproute.yaml" class="bare">https://raw.githubusercontent.com/RedHatQuickCourses/rhcl-qc-apps/refs/heads/main/kuadrant-httproute.yaml</a> | envsubst | oc apply -f -</strong>
httproute.gateway.networking.k8s.io/test created</pre>
</div>
</div>
</li>
<li>
<p>Navigate to the <em>Red Hat Openshift console</em> and select <strong>Operators</strong> &#8594; select <strong>Installed Opertor</strong> &#8594; select <strong>Kuadrant Operator</strong> &#8594; select <strong>DNSPolicy</strong> &#8594; select <strong>external-dnspolicy</strong> and notice the <strong>Conditions</strong> section.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/dns4.png" alt="dns4">
</div>
</div>
<div class="paragraph">
<p>Take note that all DNSPolicy rules are enforced after this step.</p>
</div>
</li>
<li>
<p>Navigate to the <em>Red Hat Openshift console</em> and select <strong>Operators</strong> &#8594; select <strong>Installed Opertor</strong> &#8594; select <strong>Kuadrant Operator</strong> &#8594; select <strong>All Instances</strong>:</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/all.png" alt="all">
</div>
</div>
<div class="paragraph">
<p>Take note that the status of all pods shows <strong>Accepted, Enforced</strong>.</p>
</div>
</li>
<li>
<p>Navigate to the <em>Red Hat Openshift console</em> and select <strong>Operators</strong> &#8594; select <strong>Installed Opertor</strong> &#8594; select <strong>DNS Operator</strong> &#8594; select <strong>DNSRecord</strong>:</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/all2.png" alt="all2">
</div>
</div>
<div class="paragraph">
<p>Take note that the DNS records has been created.</p>
</div>
</li>
<li>
<p>Refresh all DNS records in AWS and verify that the records have been successfully created.</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to your AWS account → navigate to <strong>Route 53</strong> → select <strong>Hosted Zones</strong> → select <strong>managed.sandboxXXXX.opentlc.com</strong>.</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/dnsrecord.png" alt="dnsrecord">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that your Gateway policies are being enforced after appling HTTP route as follows:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ oc get dnspolicy ${gatewayName}-dnspolicy -n ${gatewayNS} -o=jsonpath='{.status.conditions[?(@.type=="Enforced")].message}'
DNSPolicy has been successfully enforced

[lab-user@bastion ~]$ oc get authpolicy ${gatewayName}-auth -n ${gatewayNS} -o=jsonpath='{.status.conditions[?(@.type=="Enforced")].message}'
AuthPolicy has been successfully enforced

[lab-user@bastion ~]$ oc get ratelimitpolicy ${gatewayName}-rlp -n ${gatewayNS} -o=jsonpath='{.status.conditions[?(@.type=="Enforced")].message}'
RateLimitPolicy has been successfully enforced</pre>
</div>
</div>
</li>
<li>
<p>Create <strong>aws-credentials</strong> secret under <strong>cert-manager</strong> namespace for <strong>AWS_ACCESS_KEY_ID</strong> and <strong>AWS_SECRET_ACCESS_KEY</strong>:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ oc -n cert-manager create secret generic aws-credentials --type=kuadrant.io/aws --from-literal=AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID --from-literal=AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
secret/aws-credentials created</pre>
</div>
</div>
</li>
<li>
<p>Delete the existing pod to ensure that the secret propagates into the pods.
Navigate to <em>Red Hat Openshift console</em>, select <strong>Workloads</strong> → select <strong>Pods</strong> → select <strong>Project: cert-manager</strong> → choose cert-manager-XXXXX and delete it:</p>
<div class="imageblock text-center">
<div class="content">
<img src="_images/pod.png" alt="pod">
</div>
</div>
<div class="paragraph">
<p>Allow the pod to recreate itself and then wait for 5 minutes for the secrets to propograte in the pod.</p>
</div>
</li>
<li>
<p>Test connectivity and deny all auth.</p>
<div class="ulist">
<ul>
<li>
<p>You can use curl to hit your endpoint. You should see a 403. Because this example uses Let&#8217;s Encrypt staging, you can pass the -k flag:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ curl -k -w "%{http_code}" <a href="https://$(oc" class="bare">https://$(oc</a> get httproute test -n ${gatewayNS} -o=jsonpath='{.spec.hostnames[0]}')
403</pre>
</div>
</div>
<div class="paragraph">
<p>Above command can take 5-10 mins to return result.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that your listener is ready:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ oc get gateway ${gatewayName} -n ${gatewayNS} -o=jsonpath='{.status.listeners[0].conditions[?(@.type=="Programmed")].message}'
No errors found</pre>
</div>
</div>
</li>
<li>
<p>Open up the Gateway for other namespaces</p>
<div class="ulist">
<ul>
<li>
<p>Because you have configured the Gateway, secured it with Kuadrant policies, and tested it, you can now open it up for use by other teams in other namespaces:</p>
<div class="listingblock">
<div class="content">
<pre>[lab-user@bastion ~]$ oc patch gateway ${gatewayName} -n ${gatewayNS} --type='json' -p='[{"op": "replace", "path": "/spec/listeners/0/allowedRoutes/namespaces/from", "value":"All"}]'
gateway.gateway.networking.k8s.io/external patched</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Developer Workflow</a></span>
  <span class="next"><a href="section1.html">Toystore Application Deployment</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
