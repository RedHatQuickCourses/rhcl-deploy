= Install Kuadrant on Red Hat OpenShift cluster

In this lab, you install and setup Kuadrant Operator and trigger Kuadrant deployment.

== Prerequisites

Before installing the Kuadrant Operator, you must create the necessary namespace and set up the CatalogSource. Follow the steps below:

. Create the Namespace
* Run the following command to create the kuadrant-system namespace:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc create ns kuadrant-system**
namespace/kuadrant-system created
----

. Set Up the CatalogSource
* Apply the CatalogSource by running the following command:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc apply -f https://raw.githubusercontent.com/RedHatQuickCourses/rhcl-qc-apps/refs/heads/main/kuadrant-catalogsource.yaml**
catalogsource.operators.coreos.com/kuadrant-operator-catalog created
----

== Install the Kuadrant Operator

. To install the Kuadrant Operator, enter the following command:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc apply -f https://raw.githubusercontent.com/RedHatQuickCourses/rhcl-qc-apps/refs/heads/main/kuadrant-subscription-operatorgroup.yaml**
subscription.operators.coreos.com/kuadrant-operator created
operatorgroup.operators.coreos.com/kuadrant created
----

* Wait for the Kuadrant Operators to be installed as follows:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ oc get installplan -n kuadrant-system -o=jsonpath='{.items[0].status.phase}'
Complete
----
+
After some time, this command should return complete. 

* Notice the kuadrant operator is installed along with it's dependencies:
** https://docs.kuadrant.io/latest/authorino-operator/#the-authorino-custom-resource-definition-crd[Authorino](Enforcement Component for AuthPolicy)
** https://docs.kuadrant.io/latest/limitador-operator/#features[Limitador (Enforcement Component for RateLimitPolicy)]
** DNS Operator (Enforcement Component for DNSPOlicy)
+
image::kuad.png[align="center"]

. Configure AWS Access Key and Secret Key
* Now set up your AWS access credentials by exporting the access key ID and secret access key.
Use the following commands in your terminal, replacing xxxxxxx with your actual keys that you can find in your lab environment section:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ export AWS_ACCESS_KEY_ID=XXXXXXX
[lab-user@bastion ~]$ export AWS_SECRET_ACCESS_KEY=XXXXXX
----

. Set up a DNSProvider
* Next step is to create DNS secret Provider that would provide those DNS Provider details that we set in AWS. It is important the secret for the DNSProvider is setup in the same namespace as the gateway.
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc create ns ingress-gateway**
namespace/ingress-gateway created

[lab-user@bastion ~]$ **oc -n ingress-gateway create secret generic aws-credentials \
  --type=kuadrant.io/aws \
  --from-literal=AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
  --from-literal=AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY**
secret/aws-credentials created
----

== Deploy Kuadrant

* To trigger your Kuadrant deployment, enter the following command:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc apply -f https://raw.githubusercontent.com/RedHatQuickCourses/rhcl-qc-apps/refs/heads/main/kuadrant-resource.yaml**
kuadrant.kuadrant.io/kuadrant created
----

* Wait for Kuadrant to be ready as follows:
+
[subs="+quotes,+macros"]
----
[lab-user@bastion ~]$ **oc wait kuadrant/kuadrant --for="condition=Ready=true" -n kuadrant-system --timeout=300s**
kuadrant.kuadrant.io/kuadrant condition met
----

== References

* https://docs.kuadrant.io/0.11.0/kuadrant-operator/doc/install/install-openshift/[Install Kuadrant on an OpenShift cluster]